# Product Requirements Document (PRD): SOSenki

**Проект:** SOSenki  
**Команда:** Shared Goals  
**Версия:** 1.0 (MVP)  
**Дата:** 31 октября 2025 г.  
**Методология:** Specification-Driven Development (SDD) в режиме vibe coding

-----

## 1. Введение и Видение

SOSenki — это open-source платформа в формате **приложения внутри Telegram (Telegram Mini App)**, созданная командой "Shared Goals" для современного и прозрачного управления объектами на природе (турбазы, глемпинги, коттеджные поселки).

### 1.1. The Vibe: В чем суть проекта?

Мы создаем открытую, красивую и расширяемую платформу для управления объектами на природе в формате **приложения внутри Telegram (Telegram Mini App)**.

Философия и Vibe проекта заключается в упрощении и автоматизации процессов управления недвижимостью на природе, где каждый чувствует себя частью Общей Цели развития и улучшения территории.

Наша цель — заменить хаос из Excel-таблиц, мессенджеров и бумажных документов единым, красивым и интуитивно понятным инструментом, полностью интегрированным в Telegram, который является основным средством коммуникации для целевой аудитории.

Отношения между Ролями пользователей, реализованные в системе, определяют договоренности между сторонами Корпоративного договора, текст которого генерируется автоматически и может быть оформлен юридически.

Проект предполагает совместное развитие и лицензирован под [Apache License 2.0](LICENSE).

-----

## 2. Целевая аудитория и Пользовательские роли

Система предназначена для пяти ключевых групп пользователей:

### 2.1. Администратор (Administrator)

**Роль:** Суперпользователь  
**Численность:** Несколько человек  
**Права:**

- Управляет пользователями, ролями, настройками
- Может создавать общие `Правила`
- Запускает расчет счетов

### 2.2. Владелец Дома (Owner)

**Роль:** Собственник недвижимости  
**Численность:** ~30 человек  
**Потребности:**

- Видеть финансовое состояние своей собственности
- Своевременно оплачивать счета
- Легко управлять продажей или арендой
- Иметь возможность связаться с Арендаторами из соседних домов

### 2.3. Сотрудник (Staff)

**Роль:** Исполнитель операционных задач  
**Численность:** ~10 человек  
**Обязанности:**

- Ввод показаний счетчиков по каждому дому
- Простой интерфейс для операционных задач

### 2.4. Арендатор (Tenant)

**Роль:** Временный житель  
**Численность:** ~50 человек  
**Потребности:**

- Простой способ связи
- Оплата услуг
- Доступ к информации о проживании

### 2.5. Инвестор (Investor)

**Роль:** Потенциальный покупатель  
**Численность:** ~40 человек (прежде всего Владельцы домов, их друзья и родственники)  
**Потребности:**

- Искать возможности для покупки новой собственности
- Видеть прозрачные условия
- Участвовать в торгах

### 2.6. Процесс получения доступа

1. Пользователь запрашивает доступ на веб-странице или прямо в боте
2. Администратор получает уведомление, вручную создает пользователя, привязывает его Telegram логин и назначает роль `Инвестор`
3. Первый Администратор идентифицируется по Telegram ID (задается при инициализации системы)

-----

## 3. Требования к MVP (Minimum Viable Product)

MVP сфокусирован на создании ценности для Владельцев и Инвесторов через аукционный механизм и финансовый учет.

### 3.1. Функциональные требования

#### Эпик 1: Ядро платформы и Telegram-интеграция

##### FE-1: Бесшовная аутентификация

Как пользователь, я хочу входить в приложение без ввода логина и пароля, используя мой аккаунт Telegram.

**Базовые сущности:**

Модели для `Дома`, `Пользователя`, `Счетчиков`, `Счетов`.

**Telegram Бот для уведомлений:**

Разработка бота для отправки уведомлений.

#### Эпик 2: Личный кабинет Владельца Дома

##### FE-2: Личный кабинет Владельца

Как Владелец, я хочу видеть список моих счетов за сопровождение и электричество, чтобы понимать свои финансовые обязательства.

##### FE-3: Управление продажей

Как Владелец, я хочу выставлять свой дом на аукцион с указанием всех деталей (цена, фото, описание), чтобы найти покупателей.

#### Эпик 3: Аукцион для Инвесторов

##### FE-4: Витрина для Инвестора

Как Инвестор, я хочу видеть все дома, доступные для покупки, чтобы сделать ставку.

##### FE-5: Механизм ставок

Как Инвестор, я хочу сделать ставку на понравившийся дом, указав свою цену и контактную информацию.

##### FE-6: Ввод данных Администрацией

Как Администратор, я хочу иметь интерфейс для запуска расчета счетов. Как Сотрудник, я хочу иметь простой интерфейс для ввода показаний счетчиков по каждому дому.

##### FE-7: Публичная страница оценки

Как Администратор, я хочу видеть страницу с общей капитализацией территории, рассчитанной как сумма лучших ставок на все дома.

### 3.2. Что не входит в MVP

- Личные кабинеты Арендатора и полная версия ЛК Сотрудника (кроме формы ввода показаний)
- Онлайн-оплата счетов
- Генерация документов (договоров, инструкций)
- Функционал аренды
- Механизм общения между Владельцами и Арендаторами

### 3.3. Критерии Успеха MVP

- Приложение успешно развернуто на [инфраструктуре Yandex Cloud](https://yandex.cloud/en/services) и доступно как Telegram Mini App
- Владелец может войти, увидеть свои счета и выставить дом на продажу
- Инвестор может войти, увидеть дома и сделать ставку
- Уведомления о счетах и ставках приходят в Telegram
- Появился первый контрибьютор из сообщества, сделавший pull request в репозиторий на GitHub

-----

## 4. Use Cases (Подробные пользовательские сценарии)

### UC-A-01: Создание пользователя Администратором

**Актёр:** Администратор  
**Предусловие:** Администратор авторизован в системе  
**Основной сценарий:**

1. Администратор открывает интерфейс создания пользователя
2. Система предлагает форму с полями: `telegram_username`, `full_name`, `roles`
3. Администратор заполняет форму и нажимает "Создать"
4. Система создает пользователя, привязывает Telegram ID, назначает роли
5. Пользователь получает уведомление о доступе

**Результат:** Пользователь создан и может войти в систему

### UC-O-01: Просмотр счетов Владельцем

**Актёр:** Владелец Дома  
**Предусловие:** Владелец авторизован и имеет хотя бы один дом  
**Основной сценарий:**

1. Владелец открывает раздел "Мои Счета"
2. Система отображает список счетов с типом (`Сопровождение`, `Электричество`), суммой, периодом, статусом оплаты
3. Владелец может открыть детали счета

**Результат:** Владелец видит свои финансовые обязательства

### UC-O-02: Выставление дома на продажу

**Актёр:** Владелец Дома  
**Предусловие:** Владелец авторизован и имеет хотя бы один дом  
**Основной сценарий:**

1. Владелец открывает страницу своего дома
2. Нажимает "Выставить на продажу"
3. Заполняет форму: `buyout_price`, markdown описание, загружает фото
4. Система сохраняет изменения, устанавливает `is_for_sale = true`
5. Дом появляется в списке домов для Инвесторов

**Результат:** Дом доступен для ставок

### UC-O-03: Просмотр ставок на свой дом

**Актёр:** Владелец Дома  
**Предусловие:** Дом выставлен на продажу и есть хотя бы одна ставка
**Основной сценарий:**

1. Владелец открывает страницу своего дома
2. Система отображает анонимные ставки (без контактов инвесторов)
3. Владелец видит: количество ставок, лучшую ставку, среднюю ставку

**Результат:** Владелец понимает интерес к своему дому

### UC-O-04: Просмотр списка своих домов

**Актёр:** Владелец Дома  
**Предусловие:** Владелец авторизован  
**Основной сценарий:**

1. Владелец открывает раздел "Мои Дома"
2. Система отображает список домов с фото, номером, типом, статусом продажи
3. Владелец может открыть детали дома

**Результат:** Владелец видит всю свою недвижимость

### UC-I-01: Просмотр домов на продажу

**Актёр:** Инвестор  
**Предусловие:** Инвестор авторизован  
**Основной сценарий:**

1. Инвестор открывает раздел "Дома на продажу"
2. Система отображает список домов с фото, номером, типом, ценой выкупа, описанием
3. Инвестор может открыть детали дома

**Результат:** Инвестор видит доступные предложения

### UC-I-02: Размещение ставки на дом

**Актёр:** Инвестор  
**Предусловие:** Инвестор авторизован, дом выставлен на продажу  
**Основной сценарий:**

1. Инвестор открывает страницу дома
2. Нажимает "Сделать ставку"
3. Заполняет форму: предложенная цена, контактная информация
4. Система создает запись `Bid`, привязывает к дому
5. Владелец дома получает уведомление о новой ставке

**Результат:** Ставка размещена

### UC-I-03: Просмотр своих ставок

**Актёр:** Инвестор  
**Предусловие:** Инвестор авторизован и сделал хотя бы одну ставку  
**Основной сценарий:**

1. Инвестор открывает раздел "Мои Ставки"
2. Система отображает список ставок с домом, ценой, датой
3. Инвестор может отредактировать или отозвать ставку

**Результат:** Инвестор управляет своими предложениями

### UC-I-04: Просмотр публичной страницы оценки территории

**Актёр:** Администратор
**Предусловие:** Администратор авторизован в системе
**Основной сценарий:**

1. Администратор открывает страницу "Оценка территории"
2. Система отображает:
   - Общую капитализацию (сумма лучших ставок по всем домам)
   - Карту территории с домами и лучшими ставками
3. Данные обновляются после каждой сделанной ставки

**Результат:** Администратор видит рыночную оценку территории

### UC-S-01: Ввод показаний счетчиков

**Актёр:** Сотрудник  
**Предусловие:** Сотрудник авторизован  
**Основной сценарий:**

1. Сотрудник открывает форму ввода показаний
2. Выбирает дом из списка
3. Вводит текущее показание счетчика и дату
4. Система сохраняет запись `MeterReading`
5. При следующем расчете счетов эти данные используются для расчета потребления электричества

**Результат:** Показания зафиксированы для расчета

### UC-A-02: Запуск расчета счетов

**Актёр:** Администратор  
**Предусловие:** Администратор авторизован, введены показания счетчиков за период  
**Основной сценарий:**

1. Администратор открывает интерфейс расчета счетов
2. Выбирает период (количество месяцев с начала последнего расчета)
3. Нажимает "Рассчитать счета"
4. Система:
   - Рассчитывает счета за Сопровождение (на основе типа дома и бюджета)
   - Рассчитывает счета за Электричество (показания × тариф из `SystemSettings`)
   - Создает записи `Bill` для каждого владельца
5. Владельцы получают уведомления о новых счетах

**Результат:** Счета созданы и отправлены владельцам

### UC-A-03: Управление настройками системы

**Актёр:** Администратор  
**Предусловие:** Администратор авторизован  
**Основной сценарий:**

1. Администратор открывает раздел "Настройки"
2. Редактирует JSON конфигурацию в `SystemSettings`:
   - Тариф на электричество
   - Бюджет на сопровождение (малый дом, большой дом)
   - Прочие параметры
3. Система сохраняет изменения
4. Новые счета рассчитываются с учетом обновленных настроек

**Результат:** Настройки обновлены

### UC-SYS-01: Уведомления о новых счетах

**Актёр:** Система  
**Триггер:** Создание нового счета (UC-A-02)  
**Сценарий:**

1. Система создает счет для владельца
2. Система отправляет сообщение в Telegram:
   - Тип счета (Сопровождение / Электричество)
   - Сумма
   - Период
   - Ссылка на детали в Mini App
3. Владелец получает уведомление

**Результат:** Владелец информирован о новом счете

### UC-SYS-02: Уведомления о новых ставках

**Актёр:** Система  
**Триггер:** Размещение ставки инвестором (UC-I-02)  
**Сценарий:**

1. Система создает ставку на дом
2. Система отправляет сообщение владельцу дома в Telegram:
   - Уведомление о новой ставке (без раскрытия личности инвестора)
   - Предложенная цена
   - Ссылка на детали в Mini App
3. Владелец получает уведомление

**Результат:** Владелец информирован о новой ставке

-----

## 5. Модель Данных (Сущности)

### 5.1. Пользователи и Роли

#### Пользователь (`User`)

*Базовая сущность, представляющая пользователя системы.*

- **id**: Уникальный идентификатор - Внутренний идентификатор пользователя в системе
- **telegram_id**: Число - Уникальный числовой идентификатор пользователя в Telegram
- **telegram_username**: Строка - Имя пользователя в Telegram (например, @username)
- **full_name**: Строка - Полное имя пользователя, полученное из Telegram
- **roles**: Массив строк - Список ролей пользователя (например, `['Owner', 'Investor']`)
- **created_at**: Дата и время - Дата и время создания пользователя
- **updated_at**: Дата и время - Дата и время последнего обновления

### 5.2. Недвижимость

#### Дом (`House`)

*Основная сущность, представляющая объект недвижимости.*

- **id**: Уникальный идентификатор - Внутренний идентификатор дома
- **owner**: Связь (Пользователь) - Текущий владелец дома
- **number**: Строка - Номер дома, как он указан на карте (например, '10', '27А')
- **house_type**: Перечисление ('Малый', 'Большой', 'Баня') - Тип дома, влияет на расчет счетов за сопровождение
- **is_for_sale**: Логический - Выставлен ли дом на продажу
- **buyout_price**: Decimal - Цена выкупа, указанная владельцем
- **description**: Текст (Markdown) - Описание дома для инвесторов
- **created_at**: Дата и время - Дата и время создания записи
- **updated_at**: Дата и время - Дата и время последнего обновления

#### Фото дома (`HousePhoto`)

*Фотографии, привязанные к дому.*

- **id**: Уникальный идентификатор
- **house**: Связь (Дом) - Дом, к которому относится фото
- **photo_url**: Строка (URL) - Ссылка на изображение
- **order**: Число - Порядок отображения (для сортировки)
- **uploaded_at**: Дата и время - Дата и время загрузки

#### Ставка (`Bid`)

*Предложение инвестора о покупке дома.*

- **id**: Уникальный идентификатор
- **house**: Связь (Дом) - Дом, на который сделана ставка
- **investor**: Связь (Пользователь) - Инвестор, сделавший ставку
- **price**: Decimal - Предложенная цена
- **contact_info**: Текст - Контактная информация инвестора
- **created_at**: Дата и время - Дата и время размещения ставки

### 5.3. Финансы

#### Счет (`Bill`)

*Счет, выставленный владельцу дома.*

- **id**: Уникальный идентификатор
- **house**: Связь (Дом) - Дом, к которому относится счет
- **owner**: Связь (Пользователь) - Владелец, которому выставлен счет
- **bill_type**: Перечисление ('Сопровождение', 'Электричество') - Тип счета
- **amount**: Decimal - Сумма счета
- **period_start**: Дата - Начало периода, за который выставлен счет
- **period_end**: Дата - Конец периода
- **paid_at**: Дата - Дата и время оплаты счета
- **created_at**: Дата и время - Дата и время создания счета

#### Показания счетчиков (`MeterReading`)

*Показания счетчиков электроэнергии, используемые для расчета счетов.*

- **id**: Уникальный идентификатор
- **house**: Связь (Дом) - Дом, для которого введены показания
- **reading**: Decimal - Показание счетчика (в кВт·ч)
- **reading_date**: Дата - Дата снятия показаний
- **entered_by**: Связь (Пользователь) - Сотрудник, внесший показания
- **created_at**: Дата и время - Дата и время внесения записи

### 5.4. Система

#### Настройки системы (`SystemSettings`)

*Глобальные настройки системы, включая тарифы и бюджеты.*

- **id**: Уникальный идентификатор - Обычно одна запись
- **config**: JSON - Конфигурация в формате JSON:
  - `electricity_tariff`: Decimal - Тариф на электричество (руб/кВт·ч)
  - `accompaniment_budget_small`: Decimal - Бюджет на сопровождение малого дома (руб/год)
  - `accompaniment_budget_large`: Decimal - Бюджет на сопровождение большого дома (руб/год)
- **updated_at**: Дата и время - Дата и время последнего обновления

#### Правило (`Rule`)

*Общие правила территории, управляемые администраторами.*

- **id**: Уникальный идентификатор
- **title**: Строка - Заголовок правила
- **content**: Текст (Markdown) - Содержимое правила
- **created_by**: Связь (Пользователь) - Администратор, создавший правило
- **created_at**: Дата и время - Дата и время создания
- **updated_at**: Дата и время - Дата и время последнего обновления

-----

## 6. Архитектура и Технологический Стек

### 6.1. Архитектура

**Backend:** FastAPI на Python

**Frontend:** [Telegram Web Apps SDK](https://core.telegram.org/bots/webapps) + vanilla JavaScript

**База данных:** PostgreSQL + SQLAlchemy ORM

**Уведомления:** Telegram Bot API

### 6.2. Развертывание и Хостинг

- **CI/CD:** GitHub Actions для автоматического тестирования и деплоя
- **Хостинг:** Yandex Cloud (YC Compute Cloud, YC Managed PostgreSQL)
- Пакетное развертывание с использованием Docker и Docker Compose.
- Управление Python окружением – uv с использованием pyproject.toml и uv.lock для фиксации зависимостей.

```bash
brew install uv
```

### 6.3. Методология разработки

**Specification-Driven Development (SDD)** в режиме vibe coding:

- Использование [spec-kit от команды GitHub для управления спецификациями](https://github.com/github/spec-kit)
- Спецификации создаются перед кодированием
- Разработка ведется на основе четко определенных требований
- Частые релизы с обратной связью от пользователей

```bash
uv tool install specify-cli --from git+https://github.com/github/spec-kit.git
# Инициализация spec-kit в проекте
uv run specify init .
```

#### Структура `spec.yml`

```yaml
spec:
  version: "1.0"
  name: "SOSenki"
  description: "Platform for managing nature-based properties via Telegram Mini App"
  
  sources:
    - path: "./specs"
      type: "markdown"
    
  rules:
    - type: "completeness"
      description: "Ensure all features have corresponding documentation"
    
    - type: "consistency"
      description: "Check consistency between specs and code"
    
    - type: "coverage"
      description: "Ensure all API endpoints are documented"
  
  output:
    format: "html"
    path: "./build/spec-report"
```

#### Команды `spec-kit`

```bash
# Проверка спецификаций
uv run spec-kit check

# Генерация отчета
uv run spec-kit report

# Валидация консистентности
uv run spec-kit validate

# Обновление спецификаций
uv run spec-kit sync
```

### 6.4. Структура проекта

**С поддержкой:**

- Пакетного менеджера `uv`
- Библиотеки `spec-kit` для управления спецификациями

```
sosenki/
├── pyproject.toml                      # Конфигурация проекта для uv и инструментов
├── uv.lock                             # Lock-файл зависимостей (управляется uv)
│
├── backend/
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py                     # FastAPI app entry point
│   │   ├── api/
│   │   │   ├── __init__.py
│   │   │   ├── routes/
│   │   │   │   ├── __init__.py
│   │   │   │   ├── users.py
│   │   │   │   ├── houses.py
│   │   │   │   ├── bids.py
│   │   │   │   ├── bills.py
│   │   │   │   └── admin.py
│   │   ├── models/
│   │   │   ├── __init__.py
│   │   │   ├── user.py
│   │   │   ├── house.py
│   │   │   ├── bill.py
│   │   │   ├── bid.py
│   │   │   └── meter_reading.py
│   │   ├── schemas/
│   │   │   ├── __init__.py
│   │   │   ├── user.py
│   │   │   ├── house.py
│   │   │   ├── bill.py
│   │   │   ├── bid.py
│   │   │   └── meter_reading.py
│   │   ├── services/
│   │   │   ├── __init__.py
│   │   │   ├── bill_service.py
│   │   │   ├── bid_service.py
│   │   │   └── telegram_bot.py         # Telegram Bot for notifications
│   │   ├── dependencies/
│   │   │   ├── __init__.py
│   │   │   └── auth.py
│   │   ├── config.py                   # Environment and settings
│   │   └── database.py                 # SQLAlchemy setup
│   │
│   ├── tests/
│   │   ├── __init__.py
│   │   ├── conftest.py                 # pytest fixtures
│   │   ├── test_auth.py
│   │   ├── test_houses.py
│   │   ├── test_bids.py
│   │   └── test_bills.py
│   │
│   ├── Dockerfile
│   └── .env.example
│
├── frontend/
│   ├── src/
│   │   ├── index.html
│   │   ├── main.js
│   │   ├── pages/
│   │   │   ├── owner_dashboard.js
│   │   │   ├── investor_showcase.js
│   │   │   ├── admin_panel.js
│   │   │   ├── staff_meters.js
│   │   │   └── tenant_cabinet.js
│   │   ├── components/
│   │   │   ├── header.js
│   │   │   ├── bill_card.js
│   │   │   ├── house_card.js
│   │   │   ├── bid_form.js
│   │   │   └── navigation.js
│   │   ├── api/
│   │   │   └── client.js               # HTTP client for backend communication
│   │   ├── styles/
│   │   │   ├── main.css
│   │   │   ├── dark_theme.css          # Telegram supports dark mode
│   │   │   └── responsive.css
│   │   └── utils/
│   │       ├── telegram_sdk.js         # Telegram Mini App SDK wrapper
│   │       ├── formatting.js
│   │       └── constants.js
│   │
│   ├── public/
│   │   └── favicon.ico
│   │
│   ├── package.json
│   ├── package-lock.json
│   └── .env.example
│
├── specs/                              # spec-kit: Спецификации проекта
│   ├── spec.yml                        # Главный конфигурационный файл spec-kit
│   ├── core/
│   │   ├── models.md                   # Спецификация данных (User, House, Bill, Bid, etc.)
│   │   ├── api_endpoints.md            # Спецификация API endpoints
│   │   ├── authentication.md           # Спецификация аутентификации
│   │   └── database_schema.md          # Спецификация БД
│   ├── features/
│   │   ├── user_management.md          # Управление пользователями
│   │   ├── house_management.md         # Управление домами
│   │   ├── billing.md                  # Система счетов
│   │   ├── bidding.md                  # Система ставок
│   │   ├── notifications.md            # Уведомления в Telegram
│   │   └── admin_panel.md              # Админ-панель
│   ├── technical/
│   │   ├── architecture.md             # Архитектурные решения
│   │   ├── deployment.md               # Развертывание
│   │   ├── security.md                 # Требования безопасности
│   │   └── performance.md              # Требования производительности
│   └── use_cases/
│       ├── owner_workflows.md          # Сценарии владельца
│       ├── investor_workflows.md       # Сценарии инвестора
│       ├── admin_workflows.md          # Сценарии администратора
│       └── staff_workflows.md          # Сценарии сотрудника
│
├── docs/
│   ├── README.md                       # Main project documentation
│   ├── ARCHITECTURE.md                 # Architecture and design decisions
│   ├── SETUP.md                        # Development setup guide
│   ├── API.md                          # API endpoint documentation
│   ├── DATABASE.md                     # Database schema documentation
│   ├── CONTRIBUTING.md                 # Contribution guidelines
│   ├── DEPLOYMENT.md                   # Deployment instructions
│   └── TROUBLESHOOTING.md              # Решение распространенных проблем
│
├── scripts/
│   ├── init_db.py                      # Database initialization
│   ├── seed_demo_data.py               # Demo data for testing
│   └── telegram_bot_setup.py           # Telegram Bot API registration
│
├── docker-compose.yml                  # Local development environment
├── Dockerfile.backend                  # Backend Docker image
├── .gitignore
├── .github/
│   └── workflows/
│       ├── backend_tests.yml           # GitHub Actions for pytest
│       ├── code_quality.yml            # Linting and formatting checks
│       └── deploy.yml                  # CI/CD pipeline
│
└── LICENSE
```

-----

## 7. Приложения

### 7.1. Глоссарий

- **Telegram Mini App** — приложение, работающее внутри Telegram без установки
- **Ставка (Bid)** — предложение инвестора о покупке дома по определенной цене
- **Сопровождение** — регулярный счет за обслуживание территории и инфраструктуры
- **Показания счетчиков** — данные о потреблении электроэнергии
- **Публичная страница оценки** — страница с общей капитализацией территории

### 7.2. Ссылки

- [Yandex Cloud](https://yandex.cloud/en/services)
- [Telegram Mini Apps Documentation](https://core.telegram.org/bots/webapps)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)

SOSenki
Copyright 2025 Shared Goals

This product includes software developed by [Shared Goals](https://github.com/Shared-Goals) and its contributors.

Licensed under the Apache License, Version 2.0 (the "License")
