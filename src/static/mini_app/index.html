<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SOSenki</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div id="app">
        <div class="loading">Loading...</div>
    </div>
    
    <!-- Welcome Screen Template (registered user) -->
    <template id="welcome-template">
        <div class="page-container">
            <header class="header">
                <h1 class="brand">SOSenki</h1>
                <p class="tagline">Welcome back, <span id="user-name">User</span></p>
            </header>
            
            <main class="main-menu">
                <nav class="menu-grid">
                    <button class="menu-item" data-action="invest" id="invest-item">
                        <span class="menu-icon">üìà</span>
                        <span class="menu-label">Invest</span>
                    </button>
                    <button class="menu-item" data-action="rule">
                        <span class="menu-icon">üìã</span>
                        <span class="menu-label">Rule</span>
                    </button>
                    <button class="menu-item" data-action="enjoy">
                        <span class="menu-icon">üßò</span>
                        <span class="menu-label">Enjoy</span>
                    </button>
                </nav>
            </main>
            
            <!-- Representative Info (if representing someone) -->
            <section id="representative-info-container" class="representative-info-section"></section>
            
            <!-- All Datasets Container (unified reload) -->
            <div id="datasets-container">
                <!-- User Status Badges -->
                <section id="statuses-container" class="status-badges"></section>
                
                <!-- Stakeholder Link (owners only) -->
                <div id="stakeholder-link-container" class="stakeholder-link-container"></div>

                <!-- Properties Section (owners only) -->
                <section id="properties-container" class="properties-section">
                    <h2>Properties</h2>
                    <div id="properties-list"></div>
                </section>

                <!-- Balance Section (owners only) -->
                <section id="balance-container" class="balance-section">
                    <div class="section-header">
                        <h2>Balance</h2>
                        <a href="#" class="view-all-link" onclick="navigateToBalances(event)">View All ‚Üí</a>
                    </div>
                    <div class="balance-value">-‚ÇΩ0.00</div>
                </section>
                
                <!-- Transaction List Section -->
                <section id="transactions-section" class="transactions-section">
                    <div class="section-header">
                        <h2>Transactions</h2>
                        <a href="#" class="view-all-link" onclick="navigateToTransactions(event)">View All ‚Üí</a>
                    </div>
                    <div id="transactions-list"></div>
                </section>
                
                <!-- Bills Section (all types) -->
                <section id="bills-container" class="bills-section">
                    <h2>Bills</h2>
                    <div id="bills-list"></div>
                </section>
            </div>
        </div>
    </template>
    
    <!-- Transactions Page Template -->
    <template id="transactions-template">
        <div class="page-container">
            <header class="header">
                <button class="back-button" onclick="goBackToWelcome()">‚Üê Back</button>
                <h1>Transactions</h1>
            </header>
            
            <main class="transactions-main">
                <div id="transactions-list" class="transactions-list">
                    <!-- Transactions will be rendered here -->
                </div>
            </main>
        </div>
    </template>
    
    <!-- Balances Page Template -->
    <template id="balances-template">
        <div class="page-container">
            <header class="header">
                <button class="back-button" onclick="goBackToWelcome()">‚Üê Back</button>
                <h1>Balances</h1>
            </header>
            
            <main class="balances-main">
                <div id="balances-list" class="balances-list">
                    <!-- Balances will be rendered here -->
                </div>
            </main>
        </div>
    </template>
    
    <!-- Access Denied Template (non-registered user) -->
    <template id="access-denied-template">
        <div class="access-denied-container">
            <div class="message-box">
                <div class="icon-large">üîí</div>
                <h2>Access is limited</h2>
                <p class="instruction">
                    To get access to SOSenki, please send <code>/request</code> to the bot.
                </p>
                <button class="back-button" onclick="window.Telegram.WebApp.close()">
                    Close
                </button>
            </div>
        </div>
    </template>
    
    <!-- Error Template -->
    <template id="error-template">
        <div class="error-container">
            <div class="message-box">
                <div class="icon-large">‚ö†Ô∏è</div>
                <h2>Something went wrong</h2>
                <p class="error-message" id="error-message">Please try again later.</p>
                <details style="margin-top: 16px; text-align: left; background: #f5f5f5; padding: 8px; border-radius: 4px; font-size: 12px;">
                    <summary style="cursor: pointer; font-weight: 600;">Debug Info</summary>
                    <pre id="debug-info" style="overflow-x: auto; margin-top: 8px; white-space: pre-wrap; word-wrap: break-word; font-size: 11px;"></pre>
                    <button class="copy-button" onclick="copyDebugInfo()" style="margin-top: 8px; padding: 6px 12px; background: #0099cc; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">
                        Copy Debug Info
                    </button>
                </details>
                <button class="retry-button" onclick="location.reload()">
                    Retry
                </button>
            </div>
        </div>
    </template>
    
    <!-- Debug Console Panel -->
    <!-- <div id="debug-console" style="position: fixed; bottom: 0; left: 0; right: 0; background: #1a1a1a; color: #00ff00; font-family: monospace; font-size: 11px; max-height: 200px; overflow-y: auto; border-top: 2px solid #00ff00; z-index: 9999; padding: 8px; display: none;">
        <div style="margin-bottom: 8px; font-weight: bold;">DEBUG CONSOLE</div>
        <div id="debug-console-output"></div>
    </div> -->
    
    <script src="app.js"></script>
</body>
</html>
